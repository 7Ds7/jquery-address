/*
 * jQuery Address Plugin v1.2
 * http://www.asual.com/jquery/address/
 *
 * Copyright (c) 2009-2010 Rostislav Hristov
 * Dual licensed under the MIT and GPL licenses.
 * http://docs.jquery.com/License
 *
 * Date: 2010-02-22 02:08:10 +0200 (Mon, 22 Feb 2010)
 */
(function(d){d.address=function(){var z=function(a){d(d.address).trigger(d.extend(d.Event(a),function(){for(var b={},h=d.address.parameterNames(),e=0,n=h.length;e<n;e++)b[h[e]]=d.address.parameter(h[e]);return{value:d.address.value(),path:d.address.path(),pathNames:d.address.pathNames(),parameterNames:h,parameters:b,queryString:d.address.queryString()}}.call(d.address)))},u=function(a,b,h){if(h||b)d(d.address).bind(a,h||b,h&&b);return d.address},q=function(){var a=c.href.indexOf("#");return a!=-1?
R(F(c.href.substr(a+1))):""},S=function(a,b){if(k.strict)a=b?a.substr(0,1)!="/"?"/"+a:a:a==""?"/":a;return a},G=function(a,b){return t&&c.protocol=="file:"?b?g.replace(/\?/,"%3F"):g.replace(/%253F/,"?"):a},T=function(a){for(var b,h,e=0,n=a.childNodes.length;e<n;e++){if(a.childNodes[e].src)b=String(a.childNodes[e].src);if(h=T(a.childNodes[e]))b=h}return b},U=function(){if(!H){var a=q(),b=g!=a;if(A&&l<523){if(B!=D.length){B=D.length;if(typeof v[B-1]!=w)g=v[B-1];E(m)}}else if(t&&l<7&&b)c.reload();else if(b){g=
a;E(m)}}},E=function(a){z("change");z(a?"internalChange":"externalChange");C(V,10,f)},V=function(){var a=(c.pathname+(/\/$/.test(c.pathname)?"":"/")+d.address.value()).replace(/\/\//,"/").replace(/^\/$/,""),b=window[k.tracker];if(typeof b==I)b(a);else if(typeof _gaq!=w&&typeof _gaq.push==I)_gaq.push(["_trackPageview",a]);else if(typeof pageTracker!=w&&typeof pageTracker._trackPageview==I)pageTracker._trackPageview(a);else typeof urchinTracker==I&&urchinTracker(a)},W=function(){var a=j.contentWindow.document;
a.open();a.write("<html><head><title>"+i.title+"</title><script>var "+o+' = "'+q()+'";<\/script></head></html>');a.close()},L=function(){if(!X){X=f;if(t&&l<8){var a=i.getElementsByTagName("frameset")[0];j=i.createElement((a?"":"i")+"frame");if(a){a.insertAdjacentElement("beforeEnd",j);a[a.cols?"cols":"rows"]+=",0";j.src="javascript:false";j.noResize=f;j.frameBorder=j.frameSpacing=0}else{j.src="javascript:false";j.style.display="none";i.body.insertAdjacentElement("afterBegin",j)}C(function(){d(j).bind("load",
function(){var b=j.contentWindow;g=typeof b[o]!=w?b[o]:"";if(g!=q()){E(m);c.hash=G(g,f)}});typeof j.contentWindow[o]==w&&W()},50,f)}else if(A){if(l<418){d(i.body).append('<form id="'+o+'" style="position:absolute;top:-9999px;" method="get"></form>');K=i.getElementById(o)}if(typeof c[o]==w)c[o]={};if(typeof c[o][c.pathname]!=w)v=c[o][c.pathname].split(",")}C(function(){z("init");E(m)},1,f);if(t&&l>=8)i.body.onhashchange=U;else aa(U,50,f);d("a[rel*=address:]").address()}},o="jQueryAddress",I="function",
w="undefined",f=true,m=false,r=d.browser,l=parseFloat(d.browser.version),Y=r.mozilla,t=r.msie,p=r.opera,A=r.safari,M=m;r=function(){try{return top.document!==undefined?top:window}catch(a){return window}}();var i=r.document,D=r.history,c=r.location,aa=setInterval,C=setTimeout,F=decodeURI,R=encodeURI,s=navigator.userAgent,j,K,x=T(document),Z=x?x.indexOf("?"):-1,ba=i.title,B=D.length,H=m,X=m,N=f,$=f,J=m,v=[],g=q(),k={autoUpdate:f,history:f,strict:f};if(t){l=parseFloat(s.substr(s.indexOf("MSIE")+4));
if(i.documentMode&&i.documentMode!=l)l=i.documentMode!=8?7:8}if(M=Y&&l>=1||t&&l>=6||p&&l>=9.5||A&&l>=312){for(s=1;s<B;s++)v.push("");v.push(q());if(t&&c.hash!=q())c.hash="#"+G(q(),f);if(p)history.navigationMode="compatible";if(x&&Z!=-1){x=x.substr(Z+1).split("&");for(s=0;s<x.length;s++){p=x[s].split("=");if(/^(autoUpdate|history|strict)$/.test(p[0]))k[p[0]]=isNaN(p[1])?/^(true|yes)$/i.test(p[1]):parseInt(p[1],10)!==0;if(/^tracker$/.test(p[0]))k[p[0]]=p[1]}}if(i.readyState=="complete")L();else{window==
r&&d(L);d(r).load(L)}}else if(!M&&c.href.indexOf("#")!=-1||A&&l<418&&c.href.indexOf("#")!=-1&&c.search!=""){i.open();i.write('<html><head><meta http-equiv="refresh" content="0;url='+c.href.substr(0,c.href.indexOf("#"))+'" /></head></html>');i.close()}else V();return{init:function(a,b){return u("init",a,b)},change:function(a,b){return u("change",a,b)},internalChange:function(a,b){return u("internalChange",a,b)},externalChange:function(a,b){return u("externalChange",a,b)},baseURL:function(){var a=c.href;
if(a.indexOf("#")!=-1)a=a.substr(0,a.indexOf("#"));if(a.substr(a.length-1)=="/")a=a.substr(0,a.length-1);return a},strict:function(a){if(a!==undefined){k.strict=a;return this}return k.strict},autoUpdate:function(a){if(a!==undefined){k.autoUpdate=a;return this}return k.autoUpdate},update:function(){J=f;this.value(g);J=m;return this},history:function(a){if(a!==undefined){k.history=a;return this}return k.history},tracker:function(a){if(a!==undefined){k.tracker=a;return this}return k.tracker},title:function(a){if(a!==
undefined){a=F(a);C(function(){ba=i.title=a;if($&&j&&j.contentWindow&&j.contentWindow.document){j.contentWindow.document.title=a;$=m}if(!N&&Y)c.replace(c.href.indexOf("#")!=-1?c.href:c.href+"#");N=m},50,f);return this}return i.title},value:function(a){if(a!==undefined){a=R(F(S(a,f)));if(a=="/")a="";if(g==a&&!J)return;N=f;g=a;if(k.autoUpdate||J){H=f;E(f);v[D.length]=g;if(A)if(k.history){c[o][c.pathname]=v.toString();B=D.length+1;if(l<418){if(c.search==""){K.action="#"+g;K.submit()}}else if(l<523||
g==""){a=i.createEvent("MouseEvents");a.initEvent("click",f,f);var b=i.createElement("a");b.href="#"+g;b.dispatchEvent(a)}else c.hash="#"+g}else c.replace("#"+g);else if(g!=q())if(k.history)c.hash="#"+G(g,f);else c.replace("#"+g);t&&l<8&&k.history&&C(W,50,f);if(A)C(function(){H=m},1,f);else H=m}return this}if(!M)return null;return F(S(G(g,m),m))},path:function(a){if(a!==undefined){var b=this.queryString();this.value(a+(b?"?"+b:""));return this}a=this.value();return a.indexOf("?")!=-1?a.split("?")[0]:
a},queryString:function(a){if(a!==undefined){this.value(this.path()+(a?"?"+a:""));return this}a=this.value();var b=a.indexOf("?");if(b!=-1&&b<a.length)return a.substr(b+1)},parameter:function(a,b,h){var e,n;if(b!==undefined){var O=this.parameterNames();n=[];for(e=0;e<O.length;e++){var P=O[e],y=this.parameter(P);if(typeof y=="string")y=[y];if(P==a)y=b===null||b==""?[]:h?y.concat([b]):[b];for(var Q=0;Q<y.length;Q++)n.push(P+"="+y[Q])}d.inArray(a,O)==-1&&n.push(a+"="+b);this.queryString(n.join("&"));
return this}b=this.value();e=b.indexOf("?");if(e!=-1){b=b.substr(e+1);n=b.split("&");b=[];for(e=0;e<n.length;e++){h=n[e].split("=");h[0]==a&&b.push(h[1])}if(b.length!==0)return b.length!=1?b:b[0]}},pathNames:function(){var a=this.path(),b=a.split("/");if(a.substr(0,1)=="/"||a.length===0)b.splice(0,1);a.substr(a.length-1,1)=="/"&&b.splice(b.length-1,1);return b},parameterNames:function(){var a=this.value(),b=a.indexOf("?"),h=[];if(b!=-1){a=a.substr(b+1);if(a!=""&&a.indexOf("=")!=-1){a=a.split("&");
for(b=0;b<a.length;b++){var e=a[b].split("=")[0];d.inArray(e,h)==-1&&h.push(e)}}}return h}}}();d.fn.address=function(z){var u=function(){var q=z?z.call(this):/address:/.test(d(this).attr("rel"))?d(this).attr("rel").split("address:")[1].split(" ")[0]:d(this).attr("href").replace(/^#/,"");d.address.value(q);return false};d(this).click(u).live("click",u)}})(jQuery);
