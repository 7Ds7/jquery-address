/*
 * jQuery Address Plugin v1.2rc
 * http://www.asual.com/jquery/address/
 *
 * Copyright (c) 2009-2010 Rostislav Hristov
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * Date: 2010-04-13 14:59:16 +0300 (Tue, 13 Apr 2010)
 */
(function(c){c.address=function(){var v=function(a){c(c.address).trigger(c.extend(c.Event(a),function(){for(var b={},g=c.address.parameterNames(),h=0,q=g.length;h<q;h++)b[g[h]]=c.address.parameter(g[h]);return{value:c.address.value(),path:c.address.path(),pathNames:c.address.pathNames(),parameterNames:g,parameters:b,queryString:c.address.queryString()}}.call(c.address)))},y=function(a,b,g){if(g||b)c(c.address).bind(a,g||b,g&&b);return c.address},n=function(){var a=d.href.indexOf("#");return a!=-1?
X(F(t(d.href.substr(a+1),i))):""},Y=function(){return"javascript"},O=function(a,b){if(j.strict)a=b?a.substr(0,1)!="/"?"/"+a:a:a==""?"/":a;return a},G=function(a,b){return u&&d.protocol=="file:"?b?e.replace(/\?/,"%3F"):e.replace(/%253F/,"?"):a},t=function(a,b){if(j.crawlable&&b)return(a!=""?"!":"")+a;return a.replace(/^\!/,"")},w=function(a,b){return parseInt(a.css(b),10)},Z=function(a){for(var b,g,h=0,q=a.childNodes.length;h<q;h++){if(a.childNodes[h].src)b=String(a.childNodes[h].src);if(g=Z(a.childNodes[h]))b=
g}return b},J=function(){if(!L){var a=n(),b=e!=a;if(x&&m<523){if(D!=H.length){D=H.length;if(typeof z[D-1]!=A)e=z[D-1];I(i)}}else if(u&&m<7&&b)d.reload();else if(b){e=a;I(i)}}},I=function(a){v($);v(a?aa:ba);E(ca,10)},ca=function(){var a=(d.pathname+(/\/$/.test(d.pathname)?"":"/")+F(O(G(e,i),i))).replace(/\/\//,"/").replace(/^\/$/,""),b=window[j.tracker];if(typeof b==M)b(a);else if(typeof _gaq!=A&&typeof _gaq.push==M)_gaq.push(["_trackPageview",a]);else if(typeof pageTracker!=A&&typeof pageTracker._trackPageview==
M)pageTracker._trackPageview(a);else typeof urchinTracker==M&&urchinTracker(a)},da=function(){var a=l.contentWindow.document;a.open();a.write("<html><head><title>"+k.title+"</title><script>var "+o+' = "'+n()+'";<\/script></head></html>');a.close()},fa=function(){if(!ea){ea=f;if(j.wrap){var a=c("body");wrap=c("body > *").wrapAll('<div style="padding:'+(w(a,"marginTop")+w(a,"paddingTop"))+"px "+(w(a,"marginRight")+w(a,"paddingRight"))+"px "+(w(a,"marginBottom")+w(a,"paddingBottom"))+"px "+(w(a,"marginLeft")+
w(a,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+o+'" style="height:100%; overflow:auto;'+(x?window.statusbar.visible&&!/chrome/i.test(P)?"":" resize:both;":"")+'" />');c("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"});x&&c('<style type="text/css" />').appendTo("head").text("#"+o+"::-webkit-resizer { background-color: #fff; }")}if(u&&m<8){a=k.getElementsByTagName("frameset")[0];l=k.createElement((a?"":"i")+"frame");if(a){a.insertAdjacentElement("beforeEnd",l);a[a.cols?
"cols":"rows"]+=",0";l.src=Y()+":"+i;l.noResize=f;l.frameBorder=l.frameSpacing=0}else{l.src=Y()+":"+i;l.style.display="none";k.body.insertAdjacentElement("afterBegin",l)}E(function(){c(l).bind("load",function(){var b=l.contentWindow;e=typeof b[o]!=A?b[o]:"";if(e!=n()){I(i);d.hash=G(t(e,f),f)}});typeof l.contentWindow[o]==A&&da()},50)}else if(x){if(m<418){c(k.body).append('<form id="'+o+'" style="position:absolute;top:-9999px;" method="get"></form>');Q=k.getElementById(o)}if(typeof d[o]==A)d[o]={};
if(typeof d[o][d.pathname]!=A)z=d[o][d.pathname].split(",")}E(function(){v("init");I(i)},1);if(u&&m>7||!u&&"on"+K in p)if(p.addEventListener)p.addEventListener(K,J,false);else p.attachEvent&&p.attachEvent("on"+K,J);else ja(J,50);c("a").filter("[rel*=address:]").address()}},ka=function(){if(p.removeEventListener)p.removeEventListener(K,J,false);else p.detachEvent&&p.detachEvent("on"+K,J)},o="jQueryAddress",M="function",A="undefined",K="hashchange",$="change",aa="internalChange",ba="externalChange",
f=true,i=false,j={autoUpdate:f,crawlable:i,history:f,strict:f,wrap:i},r=c.browser,m=parseFloat(c.browser.version),ga=r.mozilla,u=r.msie,s=r.opera,x=r.safari,R=i,p=function(){try{return top.document!==undefined?top:window}catch(a){return window}}(),k=p.document,H=p.history,d=p.location,ja=setInterval,E=setTimeout,F=decodeURI,X=encodeURI,P=navigator.userAgent,l,Q,B=Z(document),ha=B?B.indexOf("?"):-1,S=k.title,D=H.length,L=i,ea=i,T=f,ia=f,N=i,z=[],e=n();if(u){m=parseFloat(P.substr(P.indexOf("MSIE")+
4));if(k.documentMode&&k.documentMode!=m)m=k.documentMode!=8?7:8;c(document).bind("propertychange",function(){if(k.title!=S&&k.title.indexOf("#"+n())!=-1)k.title=S})}if(R=ga&&m>=1||u&&m>=6||s&&m>=9.5||x&&m>=312){for(r=1;r<D;r++)z.push("");z.push(e);if(u&&d.hash!=e)d.hash="#"+G(t(e,f),f);if(s)history.navigationMode="compatible";if(B&&ha!=-1){B=B.substr(ha+1).split("&");for(r=0;r<B.length;r++){s=B[r].split("=");if(/^(autoUpdate|crawlable|history|strict|wrap)$/.test(s[0]))j[s[0]]=isNaN(s[1])?/^(true|yes)$/i.test(s[1]):
parseInt(s[1],10)!==0;if(/^tracker$/.test(s[0]))j[s[0]]=s[1]}}document.readyState=="complete"&&fa();c(fa);c(window).bind("unload",ka)}else if(!R&&n()!=""||x&&m<418&&n()!=""&&d.search!=""){k.open();k.write('<html><head><meta http-equiv="refresh" content="0;url='+encodeURI(d.href.substr(0,d.href.indexOf("#")))+'" /></head></html>');k.close()}else ca();return{init:function(a,b){return y("init",a,b)},change:function(a,b){return y($,a,b)},internalChange:function(a,b){return y(aa,a,b)},externalChange:function(a,
b){return y(ba,a,b)},baseURL:function(){var a=d.href;if(n()!="")a=a.substr(0,a.indexOf("#"));if(/\/$/.test(a))a=a.substr(0,a.length-1);return a},autoUpdate:function(a){if(a!==undefined){j.autoUpdate=a;return this}return j.autoUpdate},crawlable:function(a){if(a!==undefined){j.crawlable=a;return this}return j.crawlable},history:function(a){if(a!==undefined){j.history=a;return this}return j.history},strict:function(a){if(a!==undefined){j.strict=a;return this}return j.strict},tracker:function(a){if(a!==
undefined){j.tracker=a;return this}return j.tracker},wrap:function(a){if(a!==undefined){j.wrap=a;return this}return j.wrap},update:function(){N=f;this.value(e);N=i;return this},title:function(a){if(a!==undefined){a=F(a);E(function(){S=k.title=a;if(ia&&l&&l.contentWindow&&l.contentWindow.document){l.contentWindow.document.title=a;ia=i}if(!T&&ga)d.replace(d.href.indexOf("#")!=-1?d.href:d.href+"#");T=i},50);return this}return k.title},value:function(a){if(a!==undefined){a=X(F(O(a,f)));if(a=="/")a="";
if(e==a&&!N)return;T=f;e=a;if(j.autoUpdate||N){L=f;I(f);z[H.length]=e;if(x)if(j.history){d[o][d.pathname]=z.toString();D=H.length+1;if(m<418){if(d.search==""){Q.action="#"+t(e,f);Q.submit()}}else if(m<523||e==""){a=k.createEvent("MouseEvents");a.initEvent("click",f,f);var b=k.createElement("a");b.href="#"+t(e,f);b.dispatchEvent(a)}else d.hash="#"+t(e,f)}else d.replace("#"+t(e,f));else if(e!=n())if(j.history)d.hash="#"+G(t(e,f),f);else d.replace("#"+t(e,f));u&&m<8&&j.history&&E(da,50);if(x)E(function(){L=
i},1);else L=i}return this}if(!R)return null;return F(O(G(e,i),i))},path:function(a){if(a!==undefined){var b=this.queryString(),g=this.hash();this.value(a+(b?"?"+b:"")+(g?"#"+g:""));return this}return this.value().split("#")[0].split("?")[0]},queryString:function(a){if(a!==undefined){var b=this.hash();this.value(this.path()+(a?"?"+a:"")+(b?"#"+b:""));return this}a=this.value().split("?");return a.slice(1,a.length).join("?").split("#")[0]},parameter:function(a,b,g){var h,q;if(b!==undefined){var U=
this.parameterNames();q=[];for(h=0;h<U.length;h++){var V=U[h],C=this.parameter(V);if(typeof C=="string")C=[C];if(V==a)C=b===null||b==""?[]:g?C.concat([b]):[b];for(var W=0;W<C.length;W++)q.push(V+"="+C[W])}c.inArray(a,U)==-1&&q.push(a+"="+b);this.queryString(q.join("&"));return this}if(b=this.queryString()){q=b.split("&");b=[];for(h=0;h<q.length;h++){g=q[h].split("=");g[0]==a&&b.push(g[1])}if(b.length!==0)return b.length!=1?b:b[0]}},pathNames:function(){var a=this.path(),b=a.replace(/\/{2,9}/g,"/").split("/");
if(a.substr(0,1)=="/"||a.length===0)b.splice(0,1);a.substr(a.length-1,1)=="/"&&b.splice(b.length-1,1);return b},parameterNames:function(){var a=this.queryString(),b=[];if(a&&a.indexOf("=")!=-1){a=a.split("&");for(var g=0;g<a.length;g++){var h=a[g].split("=")[0];c.inArray(h,b)==-1&&b.push(h)}}return b},hash:function(a){if(a!==undefined){this.value(this.value().split("#")[0]+(a?"#"+a:""));return this}a=this.value().split("#");return a.slice(1,a.length).join("#")}}}();c.fn.address=function(v){this.each(function(){if(this.tagName.toLowerCase()==
"form")c("form").live("submit",function(){var n=v?v.call(this):c(this).attr("action")+"?"+c(this).serialize();c.address.value(n);return false});else{var y=function(){var n=v?v.call(this):/address:/.test(c(this).attr("rel"))?c(this).attr("rel").split("address:")[1].split(" ")[0]:c(this).attr("href").replace(/^#\!?/,"");c.address.value(n);return false};c(this).click(y).live("click",y)}})}})(jQuery);
