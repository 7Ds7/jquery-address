<!DOCTYPE html> 
<html> 
    <head> 
        <title>jQuery Address Express</title> 
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <link type="text/css" href="styles.css" rel="stylesheet">
        <script type="text/javascript" src="jquery-1.4.2.min.js"></script>
        <script type="text/javascript" src="jquery.address-1.3.min.js?state=<%= state %>"></script>
        <script type="text/javascript">

            $.address.init(function() {

                // Initializes the plugin
                $('.nav a').address();
                
            }).change(function(event) {
            
                // Selects the proper navigation link
                $('.nav a').each(function() {
                    if ($(this).attr('href') == event.path) {
                        $(this).addClass('selected').focus();
                    } else {
                        $(this).removeClass('selected');
                    }
                });

                // Handles response
                var handler = function(data) {
                    $('.content').html($('.content', data).html()).show();
                    $.address.title(/>([^<]*)<\/title/.exec(data)[1]);
                };

                // Loads the page content and inserts it into the content area
                $.ajax({
                    url: event.path,
                    error: function(XMLHttpRequest, textStatus, errorThrown) {
                        handler(XMLHttpRequest.responseText);
                    },
                    success: function(data, textStatus, XMLHttpRequest) {
                        handler(data);
                    }
                });
            });

            // Hides the tabs during initialization
            document.write('<style type="text/css"> .content { display: none; } </style>');
            
        </script> 
    </head> 
    <body> 
        <div class="page"> 
            <h1>jQuery Address State</h1>
            <ul class="nav">           
            <% for (var key in data) { %>
                <li><a href="<%= data[key].href %>"<%- selected && selected == data[key] ? ' class="selected"' : '' %>><%= data[key].title %></a></li>
            <% } %>
            </ul>
            <div class="content"><%- selected ? selected.content : 'Page not found.' %></div>
        </div>
    </body> 
</html>


