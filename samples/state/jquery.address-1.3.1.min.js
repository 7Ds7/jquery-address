/*
 * jQuery Address Plugin v1.3.1
 * http://www.asual.com/jquery/address/
 *
 * Copyright (c) 2009-2010 Rostislav Hristov
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * Date: 2010-10-10 10:31:29 +0300 (Sun, 10 Oct 2010)
 */
(function(c){c.address=function(){var x=function(a){c(c.address).trigger(c.extend(c.Event(a),function(){for(var b={},f=c.address.parameterNames(),h=0,r=f.length;h<r;h++)b[f[h]]=c.address.parameter(f[h]);return{value:c.address.value(),path:c.address.path(),pathNames:c.address.pathNames(),parameterNames:f,parameters:b,queryString:c.address.queryString()}}.call(c.address)))},y=function(a,b,f){c(c.address).bind(a,b,f);return c.address},A=function(){return z.pushState&&d.state!==i},I=function(){return("/"+
e.pathname.replace(new RegExp(d.state),"")+e.search+(H()?"#"+H():"")).replace(aa,"/")},H=function(){var a=e.href.indexOf("#");return a!=-1?B(e.href.substr(a+1),k):""},u=function(){return A()?I():H()},ua=function(){return"javascript"},R=function(a,b){if(d.strict)a=b?a.substr(0,1)!="/"?"/"+a:a:a==""?"/":a;return a},B=function(a,b){if(d.crawlable&&b)return(a!=""?"!":"")+a;return a.replace(/^\!/,"")},C=function(a,b){return parseInt(a.css(b),10)},ba=function(a){for(var b,f,h=0,r=a.childNodes.length;h<
r;h++){if(a.childNodes[h].src)b=String(a.childNodes[h].src);if(f=ba(a.childNodes[h]))b=f}return b},M=function(){if(!S){var a=u(),b=g!=a;if(D&&p<523){if(J!=z.length){J=z.length;if(G[J-1]!==i)g=G[J-1];K(k)}}else if(b)if(E&&p<7)e.reload();else{E&&p<8&&d.history&&v(V,50);g=a;K(k)}}},K=function(a){x(ca);x(a?da:ea);v(fa,10)},fa=function(){if(d.tracker!=="null"&&d.tracker!==null){var a=c.isFunction(d.tracker)?d.tracker:l[d.tracker],b=(e.pathname+e.search+(c.address&&!A()?c.address.value():"")).replace(/\/\//,
"/").replace(/^\/$/,"");if(c.isFunction(a))a(b);else if(c.isFunction(l.urchinTracker))l.urchinTracker(b);else if(l.pageTracker!==i&&c.isFunction(l.pageTracker._trackPageview))l.pageTracker._trackPageview(b);else l._gaq!==i&&c.isFunction(l._gaq.push)&&l._gaq.push(["_trackPageview",b])}},V=function(){var a=ua()+":"+k+";document.open();document.writeln('<html><head><title>"+n.title+"</title><script>var "+q+' = "'+u()+(n.domain!=e.host?'";document.domain="'+n.domain:"")+"\";<\/script></head></html>');document.close();";
if(p<7)o.src=a;else o.contentWindow.location.replace(a)},ha=function(){if(N&&ga!=-1){var a,b=N.substr(ga+1).split("&");for(s=0;s<b.length;s++){a=b[s].split("=");if(/^(autoUpdate|crawlable|history|strict|wrap)$/.test(a[0]))d[a[0]]=isNaN(a[1])?/^(true|yes)$/i.test(a[1]):parseInt(a[1],10)!==0;if(/^(state|tracker)$/.test(a[0]))d[a[0]]=a[1]}N=null}g=u()},ja=function(){if(!ia){ia=m;ha();var a=function(){va.call(this);wa.call(this)},b=c("body").ajaxComplete(a);a();if(d.wrap){c("body > *").wrapAll('<div style="padding:'+
(C(b,"marginTop")+C(b,"paddingTop"))+"px "+(C(b,"marginRight")+C(b,"paddingRight"))+"px "+(C(b,"marginBottom")+C(b,"paddingBottom"))+"px "+(C(b,"marginLeft")+C(b,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+q+'" style="height:100%; overflow:auto;'+(D?window.statusbar.visible&&!/chrome/i.test(W)?"":" resize:both;":"")+'" />');c("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"});D&&c('<style type="text/css" />').appendTo("head").text("#"+q+"::-webkit-resizer { background-color: #fff; }")}if(E&&
p<8){a=n.getElementsByTagName("frameset")[0];o=n.createElement((a?"":"i")+"frame");if(a){a.insertAdjacentElement("beforeEnd",o);a[a.cols?"cols":"rows"]+=",0";o.noResize=m;o.frameBorder=o.frameSpacing=0}else{o.style.display="none";o.style.width=o.style.height=0;o.tabIndex=-1;n.body.insertAdjacentElement("afterBegin",o)}v(function(){c(o).bind("load",function(){var f=o.contentWindow;g=f[q]!==i?f[q]:"";if(g!=u()){K(k);e.hash=B(g,m)}});o.contentWindow[q]===i&&V()},50)}else if(D){if(p<418){c(n.body).append('<form id="'+
q+'" style="position:absolute;top:-9999px;" method="get"></form>');X=n.getElementById(q)}if(e[q]===i)e[q]={};if(e[q][e.pathname]!==i)G=e[q][e.pathname].split(",")}v(function(){x("init");K(k)},1);if(!A())if(E&&p>7||!E&&"on"+O in l)if(l.addEventListener)l.addEventListener(O,M,false);else l.attachEvent&&l.attachEvent("on"+O,M);else xa(M,50)}},va=function(){var a,b=c("a"),f=b.size(),h=-1;v(function(){if(++h!=f){a=c(b.get(h));a.is("[rel*=address:]")&&a.address();v(arguments.callee,1)}},1)},ya=function(){if(g!=
u()){g=u();K(k)}},za=function(){if(l.removeEventListener)l.removeEventListener(O,M,false);else l.detachEvent&&l.detachEvent("on"+O,M)},wa=function(){var a=e.pathname.replace(/\/$/,"");c("body").html().indexOf("_escaped_fragment_")!=-1&&c("a[href]:not([href^=http]), , a[href*="+document.domain+"]",this).each(function(){var b=c(this).attr("href").replace(/^http:/,"").replace(new RegExp(a+"/?$"),"");if(b==""||b.indexOf("_escaped_fragment_")!=-1)c(this).attr("href","#"+this.decode(b.replace(/\/(.*)\?_escaped_fragment_=(.*)$/,
"!$2")))})},F=function(a){return ka(la(a)).replace(/%20/g,"+")},ma=function(a){return a.split("#")[0].split("?")[0]},na=function(a){a=ma(a);var b=a.replace(aa,"/").split("/");if(a.substr(0,1)=="/"||a.length===0)b.splice(0,1);a.substr(a.length-1,1)=="/"&&b.splice(b.length-1,1);return b},T=function(a){a=a.split("?");return a.slice(1,a.length).join("?").split("#")[0]},oa=function(a,b){if(b=T(b)){params=b.split("&");b=[];for(s=0;s<params.length;s++){var f=params[s].split("=");f[0]==a&&b.push(f.slice(1).join("="))}if(b.length!==
0)return b.length!=1?b:b[0]}},pa=function(a){var b=T(a);a=[];if(b&&b.indexOf("=")!=-1){b=b.split("&");for(var f=0;f<b.length;f++){var h=b[f].split("=")[0];c.inArray(h,a)==-1&&a.push(h)}}return a},qa=function(a){a=a.split("#");return a.slice(1,a.length).join("#")},i,q="jQueryAddress",O="hashchange",ca="change",da="internalChange",ea="externalChange",m=true,k=false,d={autoUpdate:m,crawlable:k,history:m,strict:m,wrap:k},t=c.browser,p=parseFloat(c.browser.version),ra=t.mozilla,E=t.msie,sa=t.opera,D=t.webkit,
Y=k,l=function(){try{return top.document!==i?top:window}catch(a){return window}}(),n=l.document,z=l.history,e=l.location,xa=setInterval,v=setTimeout,ka=encodeURIComponent,la=decodeURIComponent,aa=/\/{2,9}/g,W=navigator.userAgent,o,X,N=ba(document),ga=N?N.indexOf("?"):-1,Z=n.title,J=z.length,S=k,ia=k,$=m,ta=m,U=k,G=[],g=u();if(E){p=parseFloat(W.substr(W.indexOf("MSIE")+4));if(n.documentMode&&n.documentMode!=p)p=n.documentMode!=8?7:8;c(document).bind("propertychange",function(){if(n.title!=Z&&n.title.indexOf("#"+
u())!=-1)n.title=Z})}if(Y=ra&&p>=1||E&&p>=6||sa&&p>=9.5||D&&p>=312){for(var s=1;s<J;s++)G.push("");G.push(g);if(sa)history.navigationMode="compatible";if(document.readyState=="complete")var Aa=setInterval(function(){if(c.address){ja();clearInterval(Aa)}},50);else{ha();c(ja)}t=I();if(d.state!==i)if(z.pushState)t.substr(0,3)=="/#/"&&e.replace(d.state.replace(/^\/$/,"")+t.substr(2));else t!="/"&&t.replace(/^\/#/,"")!=H()&&e.replace(d.state.replace(/^\/$/,"")+"/#"+t);c(window).bind("popstate",ya).bind("unload",
za)}else!Y&&H()!=""||D&&p<418&&H()!=""&&e.search!=""?e.replace(e.href.substr(0,e.href.indexOf("#"))):fa();return{bind:function(a,b,f){return y(a,b,f)},init:function(a){return y("init",a)},change:function(a){return y(ca,a)},internalChange:function(a){return y(da,a)},externalChange:function(a){return y(ea,a)},baseURL:function(){var a=e.href;if(a.indexOf("#")!=-1)a=a.substr(0,a.indexOf("#"));if(/\/$/.test(a))a=a.substr(0,a.length-1);return a},autoUpdate:function(a){if(a!==i){d.autoUpdate=a;return this}return d.autoUpdate},
crawlable:function(a){if(a!==i){d.crawlable=a;return this}return d.crawlable},history:function(a){if(a!==i){d.history=a;return this}return d.history},state:function(a){if(a!==i){d.state=a;return this}return d.state},strict:function(a){if(a!==i){d.strict=a;return this}return d.strict},tracker:function(a){if(a!==i){d.tracker=a;return this}return d.tracker},wrap:function(a){if(a!==i){d.wrap=a;return this}return d.wrap},update:function(){U=m;this.value(g);U=k;return this},encode:function(a){var b=na(a),
f=pa(a),h=T(a),r=qa(a),P=a.substr(0,1),L=a.substr(a.length-1),j="";c.each(b,function(w,Q){j+="/"+F(Q)});if(h!==""){j+="?";if(f.length===0)j+=h;else{c.each(f,function(w,Q){w=oa(Q,a);if(typeof w!=="string")c.each(w,function(Ca,Ba){j+=F(Q)+"="+F(Ba)+"&"});else j+=F(Q)+"="+F(w)+"&"});j=j.substr(0,j.length-1)}}if(r!=="")j+="#"+F(r);if(P!="/"&&j.substr(0,1)=="/")j=j.substr(1);if(/#|&|\?/.test(L))j+=L;return j},decode:function(a){return la(a.replace(/\+/g,"%20"))},title:function(a){if(a!==i){v(function(){Z=
n.title=a;if(ta&&o&&o.contentWindow&&o.contentWindow.document){o.contentWindow.document.title=a;ta=k}if(!$&&ra)e.replace(e.href.indexOf("#")!=-1?e.href:e.href+"#");$=k},50);return this}return n.title},value:function(a){if(a!==i){a=R(this.encode(a),m);if(a=="/")a="";if(g==a&&!U)return;$=m;g=a;if(d.autoUpdate||U){K(m);if(A())z[d.history?"pushState":"replaceState"]({},"",d.state.replace(/\/$/,"")+(g==""?"/":g));else{S=m;G[z.length]=g;if(D)if(d.history){e[q][e.pathname]=G.toString();J=z.length+1;if(p<
418){if(e.search==""){X.action="#"+B(g,m);X.submit()}}else if(p<523||g==""){a=n.createEvent("MouseEvents");a.initEvent("click",m,m);var b=n.createElement("a");b.href="#"+B(g,m);b.dispatchEvent(a)}else e.hash="#"+B(g,m)}else e.replace("#"+B(g,m));else if(g!=u())if(d.history)e.hash="#"+B(g,m);else e.replace("#"+B(g,m));E&&p<8&&d.history&&v(V,50);if(D)v(function(){S=k},1);else S=k}}return this}if(!Y)return null;return R(this.decode(g),k)},path:function(a){if(a!==i){var b=this.queryString(),f=this.hash();
this.value(a+(b?"?"+b:"")+(f?"#"+f:""));return this}return ma(this.value())},pathNames:function(){return na(this.value())},queryString:function(a){if(a!==i){var b=this.hash();this.value(this.path()+(a?"?"+a:"")+(b?"#"+b:""));return this}return this.decode(T(R(g,k)))},parameter:function(a,b,f){var h,r;if(b!==i){var P=this.parameterNames();r=[];b=b?ka(b):"";for(h=0;h<P.length;h++){var L=P[h],j=this.parameter(L);if(typeof j=="string")j=[j];if(L==a)j=b===null||b===""?[]:f?j.concat([b]):[b];for(var w=
0;w<j.length;w++)r.push(L+"="+F(j[w]))}c.inArray(a,P)==-1&&b!==null&&b!==""&&r.push(a+"="+F(b));this.queryString(r.join("&"));return this}a=oa(a,R(g,k));if(a!==i)if(typeof a=="string")a=this.decode(a);else for(b=0;b<a.length;b++)a[b]=this.decode(a[b]);return a},parameterNames:function(){return pa(this.value())},hash:function(a){if(a!==i){this.value(this.value().split("#")[0]+(a?"#"+a:""));return this}return qa(this.value())}}}();c.fn.address=function(x){if(!c(this).attr("address")){var y=function(A){if(c(this).is("a")){var I=
x?x.call(this):/address:/.test(c(this).attr("rel"))?c(this).attr("rel").split("address:")[1].split(" ")[0]:c.address.state()!==undefined&&c.address.state()!="/"?c(this).attr("href").replace(new RegExp("^(.*"+c.address.state()+"|\\.)"),""):c(this).attr("href").replace(/^(#\!?|\.)/,"");c.address.value(I);A.preventDefault()}};c(this).click(y).live("click",y).submit(function(A){if(c(this).is("form")){var I=x?x.call(this):c(this).attr("action")+"?"+c.address.decode(c(this).serialize());c.address.value(I);
A.preventDefault()}}).attr("address",true)}return this}})(jQuery);
